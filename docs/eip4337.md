# EIP4337 Abstract Account

## ğŸ—ï¸ Architecture Overview

```
User â†’ UserOperation â†’ Bundler â†’ EntryPoint â†’ Smart Wallet â†’ Execution
```

## ğŸ‘¥ Key Roles

### **User**
- **Role**: Owner of Smart Contract Account
- **Responsibilities**:
  - Creates and signs UserOperations
  - Manages wallet permissions and recovery
  - Can optionally pre-deposit ETH for gas payments

### **Bundler**
- **Role**: Transaction Packager & MEV Searcher
- **Responsibilities**:
  - Receives UserOperations from users/wallets
  - Validates operations via local simulation
  - Batches multiple UserOps into efficient bundles
  - Calls EntryPoint's `handleOps` method
  - Pays upfront gas costs, receives refunds + fees
  - Protects against DoS and invalid operations

### **EntryPoint Contract**
- **Role**: Singleton Universal Execution Gateway
- **Address**: `0x4337084d9e255ff0702461cf8895ce9e3b5ff108` (cross-chain)
- **Responsibilities**:
  - Validates UserOperation authenticity
  - Enforces security rules and replay protection
  - Executes user intents through smart wallets
  - Handles gas accounting and fee distribution
  - Manages deposit/withdrawal for accounts

### **Paymaster** (Optional)
- **Role**: Gas Fee Sponsor
- **Responsibilities**:
  - Sponsors gas fees for users

## ğŸ’° Payment Methods

### 1. **Self-Paid (User Deposits)**
```solidity
// User pre-deposits ETH for gas
account.addDeposit{value: 1 ether}();

// UserOp without paymaster
userOp.paymasterAndData = "";
```

**Flow**: User Deposit â†’ EntryPoint â†’ Gas Deduction

### 2. **Sponsored (Paymaster)**
```solidity
// Paymaster sponsors the transaction
userOp.paymasterAndData = abi.encodePacked(
    paymasterAddress,
    validUntil,
    validAfter,
    signature
);
```

**Flow**: Paymaster Deposit â†’ EntryPoint â†’ Sponsored Execution

### 3. **Token Payment** (Advanced)
- Pay gas fees using ERC-20 tokens
- Automatic token-to-ETH conversion
- Custom exchange rate logic
